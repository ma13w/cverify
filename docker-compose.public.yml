# CVerify - Public Application Only
# For self-hosting without relay server
version: "3.8"

services:
  public:
    build:
      context: ./public
      dockerfile: Dockerfile
    container_name: cverify-public
    restart: unless-stopped
    ports:
      - "${PUBLIC_PORT:-8080}:80"
    volumes:
      # Persist user/company data
      - ./data/user:/var/www/html/user/data
      - ./data/company:/var/www/html/company/data
      # Mount custom config
      - ./public/config.php:/var/www/html/config.php:ro
    environment:
      - PHP_OPCACHE_ENABLE=1
      - APACHE_RUN_USER=www-data
      - APACHE_RUN_GROUP=www-data
      # Point to external relay server
      - RELAY_SERVER_URL=${RELAY_SERVER_URL:-https://relay.cverify.example.com}
    networks:
      - cverify-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s
    labels:
      - "com.cverify.service=public"
      - "com.cverify.description=CVerify self-hosted instance"

networks:
  cverify-network:
    driver: bridge
